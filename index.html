<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Batre3Lit - Enhanced</title>
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="manifest" href="site.webmanifest">
  <meta name="theme-color" content="#696ccf">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <style>
    :root {
      --primary-color: #3498db;
      --secondary-color: #2980b9;
      --success-color: #27ae60;
      --warning-color: #f39c12;
      --danger-color: #e74c3c;
      --light-bg: #ecf0f1;
      --dark-text: #2c3e50;
      --medium-text: #34495e;
      --border-color: #bdc3c7;
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      --gradient-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--gradient-bg);
      padding: 15px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }

    .container-main {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 30px;
      border-radius: 20px;
      box-shadow: var(--shadow);
      max-width: 480px;
      width: 100%;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header h1 {
      color: var(--dark-text);
      font-weight: 700;
      font-size: 2.2rem;
      margin-bottom: 5px;
      background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header p {
      color: var(--medium-text);
      font-size: 0.9rem;
      margin: 0;
    }

    .battery-display {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 25px;
      border: 2px solid rgba(52, 152, 219, 0.1);
      transition: all 0.3s ease;
    }

    .battery-display:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    }

    .battery-percentage {
      font-size: 2.5rem;
      font-weight: 700;
      margin: 0;
      line-height: 1;
    }

    .battery-icon {
      font-size: 3rem;
      transition: all 0.3s ease;
    }

    .battery-status {
      font-size: 0.9rem;
      opacity: 0.8;
      margin-top: 5px;
    }

    .brand-info {
      text-align: right;
    }

    .brand-info h4 {
      color: var(--dark-text);
      margin-bottom: 5px;
      font-weight: 600;
    }

    .brand-info p {
      color: var(--medium-text);
      margin: 0;
      font-size: 0.9rem;
    }

    .input-group {
      margin-bottom: 20px;
    }

    .input-group label {
      font-size: 16px;
      color: var(--medium-text);
      font-weight: 500;
      margin-bottom: 8px;
      display: block;
    }

    .input-group input {
      width: 100%;
      padding: 12px 16px;
      font-size: 16px;
      border: 2px solid var(--border-color);
      border-radius: 10px;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.8);
    }

    .input-group input:focus {
      border-color: var(--primary-color);
      outline: none;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
      background: white;
    }

    .input-group input:invalid {
      border-color: var(--danger-color);
    }

    .btn-calculate {
      width: 100%;
      padding: 14px;
      font-size: 16px;
      font-weight: 600;
      background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .btn-calculate:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(52, 152, 219, 0.3);
    }

    .btn-calculate:active {
      transform: translateY(0);
    }

    .btn-calculate:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .results {
      margin-top: 25px;
      background: linear-gradient(135deg, #f8f9fa, #ffffff);
      padding: 20px;
      border-radius: 15px;
      border: 1px solid rgba(52, 152, 219, 0.1);
      box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .result-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .result-item:hover {
      background: rgba(255, 255, 255, 0.9);
      transform: translateX(5px);
    }

    .result-item:last-child {
      margin-bottom: 0;
    }

    .result-label {
      font-weight: 600;
      color: var(--medium-text);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .result-value {
      font-weight: 700;
      color: var(--dark-text);
      font-size: 1.1rem;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(52, 152, 219, 0.2);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 15px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
      transition: width 0.5s ease;
      border-radius: 4px;
    }

    .alert {
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: none;
      font-weight: 500;
    }

    .alert-warning {
      background: rgba(243, 156, 18, 0.1);
      color: #d68910;
      border-left: 4px solid var(--warning-color);
    }

    .alert-error {
      background: rgba(231, 76, 60, 0.1);
      color: #c0392b;
      border-left: 4px solid var(--danger-color);
    }

    .loading {
      display: none;
      text-align: center;
      margin: 20px 0;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(52, 152, 219, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary-color);
      animation: spin 1s ease-in-out infinite;
      margin: 0 auto 10px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Responsive Design */
    @media (max-width: 576px) {
      body {
        padding: 10px;
      }
      
      .container-main {
        padding: 20px;
      }
      
      .header h1 {
        font-size: 1.8rem;
      }
      
      .battery-percentage {
        font-size: 2rem;
      }
      
      .battery-icon {
        font-size: 2.5rem;
      }
      
      .battery-display {
        padding: 15px;
      }
    }

    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      :root {
        --light-bg: #06090c;
        --dark-text: #06090c;
        --medium-text: #374e64;
      }
    }
  </style>
</head>

<body>
  <div class="container-main">
    <div class="header">
      <h1>Batre3Lit</h1>
      <p>Kalkulator Baterai Stareer 3 Liter</p>
    </div>

    <div class="battery-display">
      <div class="row align-items-center">
        <div class="col-7">
          <h2 id="battery-percentage" class="battery-percentage text-muted">--</h2>
          <div class="battery-status" id="battery-status">Masukkan persentase baterai</div>
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
          </div>
        </div>
        <div class="col-5 text-end">
          <i id="battery-icon" class="bi bi-battery battery-icon text-muted"></i>
          <div class="brand-info mt-2">
            <h4>Stareer</h4>
            <p>3 Liter</p>
          </div>
        </div>
      </div>
    </div>

    <div class="mb-3">
      <label for="battery-input" class="form-label">
        <i class="bi bi-lightning-charge"></i>
        Sisa Baterai Saat Ini (%)
      </label>
      <input 
        type="number" 
        id="battery-input" 
        min="0" 
        max="100" 
        placeholder="Contoh: 40"
        class="form-control"
      >
    </div>

    <button class="btn-calculate" onclick="calculateAll()">
      <i class="bi bi-calculator"></i>
      Hitung Estimasi
    </button>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>Menghitung estimasi...</p>
    </div>

    <div class="results fade-in" id="results" style="display: none;">
      <div class="result-item">
        <div class="result-label">
          <i class="bi bi-geo-alt text-primary"></i>
          Jarak Tempuh Tersisa
        </div>
        <div class="result-value" id="distance-remaining">-- km</div>
      </div>
      
      <div class="result-item">
        <div class="result-label">
          <i class="bi bi-clock text-success"></i>
          Waktu Untuk Penuh
        </div>
        <div class="result-value" id="charging-time">--</div>
      </div>
      
      <div class="result-item">
        <div class="result-label">
          <i class="bi bi-alarm text-warning"></i>
          Penuh Pada Pukul
        </div>
        <div class="result-value" id="completion-time">--</div>
      </div>
      
      <div class="result-item">
        <div class="result-label">
          <i class="bi bi-lightning text-info"></i>
          Estimasi Konsumsi
        </div>
        <div class="result-value" id="power-consumption">-- Wh/km</div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Configuration constants
    const CONFIG = {
      TOTAL_DISTANCE: 60, // km
      BATTERY_CAPACITY_WH: 1152, // 48V * 24Ah = 1152 Wh
      CHARGER_POWER: 144, // 48V * 3A = 144W
      CHARGING_EFFICIENCY: 1.15, // 15% loss factor
      POWER_CONSUMPTION_PER_KM: 19.2 // Wh/km (1152 Wh / 60 km)
    };

    // State management
    let currentBatteryLevel = 0;
    let lastCalculationTime = 0;

    // DOM elements
    const batteryInput = document.getElementById('battery-input');
    const batteryPercentage = document.getElementById('battery-percentage');
    const batteryIcon = document.getElementById('battery-icon');
    const batteryStatus = document.getElementById('battery-status');
    const progressFill = document.getElementById('progress-fill');
    const results = document.getElementById('results');
    const loading = document.getElementById('loading');

    // Initialize app
    window.addEventListener('load', initializeApp);
    // batteryInput.addEventListener('input', handleBatteryInput);
    // batteryInput.addEventListener('keypress', handleKeyPress);

    function initializeApp() {
      loadPreviousData();
      updateDateTime();
      setInterval(updateDateTime, 1000);
    }

    function loadPreviousData() {
      const savedBattery = localStorage.getItem('lastBatteryInput');
      if (savedBattery !== null && savedBattery !== '') {
        const level = parseFloat(savedBattery);
        if (level >= 0 && level <= 100) {
          batteryInput.value = level;
          updateBatteryDisplay(level);
          calculateAll();
        }
      }
    }

    function handleBatteryInput(event) {
      const value = parseFloat(event.target.value);
      if (!isNaN(value) && value >= 0 && value <= 100) {
        updateBatteryDisplay(value);
        clearTimeout(lastCalculationTime);
        lastCalculationTime = setTimeout(() => {
          calculateAll();
        }, 500); // Debounce calculation
      } else {
        resetDisplay();
      }
    }

    function handleKeyPress(event) {
      if (event.key === 'Enter') {
        calculateAll();
      }
    }

    function updateBatteryDisplay(percentage) {
      currentBatteryLevel = percentage;
      
      // Update percentage display
      batteryPercentage.textContent = percentage + '%';
      batteryPercentage.classList.remove('text-muted');
      
      // Update progress bar
      progressFill.style.width = percentage + '%';
      
      // Update battery icon and colors
      batteryIcon.className = 'bi battery-icon';
      batteryIcon.classList.remove('text-muted', 'text-success', 'text-warning', 'text-danger');
      
      if (percentage >= 75) {
        batteryIcon.classList.add('bi-battery-full', 'text-success');
        batteryPercentage.classList.add('text-success');
        batteryStatus.textContent = 'Baterai Penuh';
      } else if (percentage >= 50) {
        batteryIcon.classList.add('bi-battery-half', 'text-success');
        batteryPercentage.classList.add('text-success');
        batteryStatus.textContent = 'Baterai Cukup';
      } else if (percentage >= 25) {
        batteryIcon.classList.add('bi-battery-half', 'text-warning');
        batteryPercentage.classList.add('text-warning');
        batteryStatus.textContent = 'Baterai Sedang';
      } else {
        batteryIcon.classList.add('bi-battery', 'text-danger');
        batteryPercentage.classList.add('text-danger');
        batteryStatus.textContent = 'Baterai Rendah';
      }
    }

    function resetDisplay() {
      batteryPercentage.textContent = '--';
      batteryPercentage.className = 'battery-percentage text-muted';
      batteryIcon.className = 'bi bi-battery battery-icon text-muted';
      batteryStatus.textContent = 'Masukkan persentase baterai';
      progressFill.style.width = '0%';
      results.style.display = 'none';
    }

    function showLoading() {
      loading.style.display = 'block';
      results.style.display = 'none';
    }

    function hideLoading() {
      loading.style.display = 'none';
    }

    function calculateAll() {
      const input = parseFloat(batteryInput.value);
      
      // Validation
      if (isNaN(input) || input < 0 || input > 100) {
        showError('Masukkan angka antara 0 hingga 100');
        return;
      }

      showLoading();
      
      // Simulate calculation delay for better UX
      setTimeout(() => {
        try {
          const calculations = performCalculations(input);
          displayResults(calculations);
          saveBatteryLevel(input);
          hideLoading();
        } catch (error) {
          console.error('Calculation error:', error);
          showError('Terjadi kesalahan dalam perhitungan');
          hideLoading();
        }
      }, 300);
    }

    function performCalculations(batteryLevel) {
      // Distance calculation
      const remainingDistance = (batteryLevel / 100) * CONFIG.TOTAL_DISTANCE;
      
      // Charging time calculation
      const remainingCapacity = 100 - batteryLevel;
      const energyNeeded = (remainingCapacity / 100) * CONFIG.BATTERY_CAPACITY_WH;
      const chargingTimeHours = (energyNeeded / CONFIG.CHARGER_POWER) * CONFIG.CHARGING_EFFICIENCY;
      
      // Completion time calculation
      const now = new Date();
      const completionTime = new Date(now.getTime() + chargingTimeHours * 60 * 60 * 1000);
      
      return {
        remainingDistance: remainingDistance.toFixed(1),
        chargingTimeHours: chargingTimeHours,
        completionTime: completionTime,
        powerConsumption: CONFIG.POWER_CONSUMPTION_PER_KM.toFixed(1)
      };
    }

    function displayResults(calc) {
      // Format charging time
      const hours = Math.floor(calc.chargingTimeHours);
      const minutes = Math.round((calc.chargingTimeHours - hours) * 60);
      const chargingTimeText = hours > 0 ? `${hours} jam ${minutes} menit` : `${minutes} menit`;
      
      // Format completion time
      const completionTimeText = calc.completionTime.toLocaleTimeString('id-ID', {
        hour: '2-digit',
        minute: '2-digit'
      });
      
      // Update result displays
      document.getElementById('distance-remaining').textContent = calc.remainingDistance + ' km';
      document.getElementById('charging-time').textContent = chargingTimeText;
      document.getElementById('completion-time').textContent = completionTimeText;
      document.getElementById('power-consumption').textContent = calc.powerConsumption + ' Wh/km';
      
      // Show results with animation
      results.style.display = 'block';
      results.classList.add('fade-in');
      
      // Remove animation class after animation completes
      setTimeout(() => {
        results.classList.remove('fade-in');
      }, 500);
    }

    function showError(message) {
      results.innerHTML = `
        <div class="alert alert-error">
          <i class="bi bi-exclamation-triangle"></i>
          ${message}
        </div>
      `;
      results.style.display = 'block';
    }

    function saveBatteryLevel(level) {
      localStorage.setItem('lastBatteryInput', level.toString());
      localStorage.setItem('lastCalculationTime', Date.now().toString());
    }

    function updateDateTime() {
      // This function can be extended to show current time in the UI
      // For now, it's just a placeholder for future enhancements
    }

    // PWA Service Worker Registration
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(registration => {
          console.log('Service Worker registered successfully:', registration.scope);
        })
        .catch(error => {
          console.log('Service Worker registration failed:', error);
        });
    }

    // Prevent form submission on Enter key
    document.addEventListener('keypress', function(event) {
      if (event.key === 'Enter' && event.target.tagName !== 'BUTTON') {
        event.preventDefault();
      }
    });
  </script>
</body>
</html>
